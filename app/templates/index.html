{% extends "base.html" %}

{% block content %}
<div class="mode-toggle">
    <label class="switch">
        <input type="checkbox" id="mode-switch">
        <span class="slider round"></span>
    </label>
    <span id="mode-label">Quick Mode</span>
</div>

<form id="prediction-form" method="POST" action="{{ url_for('main.calculate') }}">
    <div class="state-grid">
        {% for state_code, state in states.items() %}
        <div class="state-card" data-state="{{ state_code }}">
            <h3>{{ state.name }}</h3>
            <p>Electoral Votes: {{ state.votes }}</p>
            
            <!-- Quick Mode -->
            <div class="quick-mode-input">
                <label>Winning Probability:</label>
                <select name="{{ state_code }}-quick" class="probability-select">
                    <option value="0.99">Very Likely Dem (99%)</option>
                    <option value="0.75">Likely Dem (75%)</option>
                    <option value="0.60">Lean Dem (60%)</option>
                    <option value="0.50" selected>Toss-up (50%)</option>
                    <option value="0.40">Lean Rep (40%)</option>
                    <option value="0.25">Likely Rep (25%)</option>
                    <option value="0.01">Very Likely Rep (1%)</option>
                </select>
            </div>
            
            <!-- Advanced Mode -->
            <div class="advanced-mode-input" style="display: none;">
                <div class="poll-input">
                    <label for="{{ state_code }}-poll">Poll %:</label>
                    <input type="number" 
                           id="{{ state_code }}-poll" 
                           name="{{ state_code }}-poll"
                           min="0" 
                           max="100" 
                           step="0.1"
                           class="poll-input">
                </div>
                <div class="margin-input">
                    <label for="{{ state_code }}-margin">Margin of Error:</label>
                    <input type="number" 
                           id="{{ state_code }}-margin" 
                           name="{{ state_code }}-margin"
                           min="0" 
                           max="20" 
                           step="0.1"
                           class="margin-input">
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div class="form-actions">
        <button type="submit" class="calculate-btn">Calculate Probability</button>
    </div>
</form>

<div id="results" class="results-section" {% if not results %}style="display: none;"{% endif %}>
    <h2>Results</h2>
    <div class="results-visualization">
        <div class="ev-meter">
            <div class="ev-bar" style="width: {{ (results.expected_votes/538*100) if results else 0 }}%"></div>
            <div class="ev-marker" style="left: 50%">270</div>
        </div>
        {% if results %}
            <p class="probability">Probability of winning: <span class="highlight">{{ results.probability }}%</span></p>
            <p class="ev-count">Expected electoral votes: <span class="highlight">{{ results.expected_votes }}</span></p>
            
            <!-- Add canvas for distribution chart -->
            <div class="distribution-chart-container">
                <canvas id="distributionChart"></canvas>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
